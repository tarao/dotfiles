# Core tmux configuration
# Analog to .screen/common.screenrc

# Escape key: Ctrl+z Ctrl+z (same as screen)
set -g prefix C-z
bind C-z send-prefix
unbind C-b

# Window navigation: Space for next, Backspace for previous
bind Space next-window
bind BSpace previous-window

# Window management: X to kill window
bind X confirm-before -p "kill-window #W? (y/n)" kill-window

# Pane splitting (s: horizontal, v: vertical)
bind S split-window -v -c "#{pane_current_path}"
bind V split-window -h -c "#{pane_current_path}"

# Pane navigation (Vi-like: h, j, k, l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing (prefix + H/J/K/L, repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Scrollback: 8192 lines
set -g history-limit 8192

# 256 color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# UTF-8 (tmux 2.2+ assumes UTF-8, but set for compatibility)
set -g status on

# Pane borders (Catppuccin Mocha theme)
set -g pane-border-style "fg=#45475a"
set -g pane-active-border-style "fg=#cba6f7"

# Status bar (Catppuccin Mocha theme)
set -g status-position bottom
set -g status-style "bg=#1e1e2e,fg=#cdd6f4"

# Left: hostname
set -g status-left "#[fg=#1e1e2e,bg=#89b4fa,bold] #H #[fg=#89b4fa,bg=#1e1e2e]"
set -g status-left-length 30

# Right: mode indicator (without "-mode" suffix)
set -g status-right "#{?client_prefix,#[fg=#1e1e2e]#[bg=#f9e2af]#[bold] PREFIX #[default] ,}#{?pane_in_mode,#[fg=#1e1e2e]#[bg=#a6e3a1]#[bold] COPY #[default] ,}"
set -g status-right-length 50

# Window list (tab-like with truncation)
# Non-active: max 12 chars, Active: max 24 chars
set -g window-status-format "#[fg=#6c7086,bg=#313244] #I:#{=12:window_name} #[fg=#313244,bg=#1e1e2e]"
set -g window-status-current-format "#[fg=#1e1e2e,bg=#cba6f7,bold] #I:#{=24:window_name} #[fg=#cba6f7,bg=#1e1e2e]"
set -g window-status-separator ""

# Mouse support (useful for WSL2)
set -g mouse on

# Default shell
set -g default-shell /usr/bin/zsh

# Window numbering starts at 0 (same as screen)
set -g base-index 0
set -g pane-base-index 0

# Vi mode for copy
set -g mode-keys vi

# Copy mode key bindings (J/K for half page down/up like screen)
bind-key -T copy-mode-vi C-d send-keys -X halfpage-down
bind-key -T copy-mode-vi C-u send-keys -X halfpage-up
bind-key -T copy-mode-vi J send-keys -X halfpage-down
bind-key -T copy-mode-vi K send-keys -X halfpage-up

# Vi-like visual mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi V send-keys -X select-line
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Clipboard integration with xsel
set -g set-clipboard on
bind-key -T copy-mode-vi Space send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xsel -b -i"
bind-key -T copy-mode-vi Y send-keys -X copy-pipe-and-cancel "xsel -b -i"
bind-key -T copy-mode-vi W send-keys -X copy-pipe-and-cancel "xsel -b -i"
bind-key P run "xsel -b -o | tmux load-buffer - ; tmux paste-buffer"

# Automatic window rename
setw -g automatic-rename on
setw -g automatic-rename-format "#{pane_current_command}"

# Aggressive resize
setw -g aggressive-resize on

# Automatic title control via TMUX_TITLE environment variable
setenv -g TMUX_TITLE auto
